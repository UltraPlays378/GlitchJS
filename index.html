<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Convo - Static Edition</title>
    <style>
        * { box-sizing: border-box; }
        body, html {
            margin: 0; padding: 0; width: 100vw; height: 100vh;
            background-color: #f8f9fa; display: flex;
            flex-direction: column; align-items: center; overflow: hidden;
            font-family: 'Segoe UI', Tahoma, sans-serif; color: #333;
        }

        #header-container { width: 100%; padding-top: 50px; text-align: center; }

        #speaker-name {
            font-size: 1rem; font-weight: 700; color: #888;
            margin-bottom: 10px; text-transform: uppercase; letter-spacing: 3px;
            opacity: 0; transition: opacity 0.4s ease;
        }

        .divider-line {
            width: 60%; max-width: 500px; height: 1px; background-color: #ddd;
            margin: 0 auto; transform: scaleX(0);
            transition: transform 0.7s cubic-bezier(0.65, 0, 0.35, 1), background-color 0.4s ease;
            transform-origin: center;
        }

        .line-open { transform: scaleX(1); }

        #message-box {
            flex-grow: 1; display: flex; justify-content: center;
            align-items: center; width: 85vw; padding: 40px;
        }

        h1 {
            max-width: 100%; text-align: center; line-height: 1.6;
            font-size: 1.6rem; font-weight: 400; opacity: 1;
            transition: color 0.4s ease, opacity 0.5s ease-in-out;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

    <div id="header-container">
        <div id="speaker-name">SYSTEM</div>
        <div class="divider-line" id="line"></div>
    </div>

    <div id="message-box">
        <h1 id="typing-text" aria-live="polite"></h1>
    </div>

<script>
    function pickRandom(list) {
        return list[Math.floor(Math.random() * list.length)];
    }

    function createStoryState() {
        const settings = [
            "a quiet moon base",
            "an underwater research station",
            "a floating city in the clouds",
            "a tiny village inside a giant tree",
            "a train traveling through time"
        ];

        const goals = [
            "find a missing map",
            "fix a failing reactor",
            "prepare for a surprise festival",
            "decode a mysterious signal",
            "rescue a stranded explorer"
        ];

        const obstacles = [
            "a locked gate with a riddle",
            "a sudden power outage",
            "a confusing set of clues",
            "a storm that blocks the path",
            "a robot that only speaks in puzzles"
        ];

        const helpers = [
            "an old mechanic",
            "a cheerful drone",
            "a librarian with secret notes",
            "a clever street artist",
            "a retired captain"
        ];

        return {
            setting: pickRandom(settings),
            goal: pickRandom(goals),
            obstacle: pickRandom(obstacles),
            helper: pickRandom(helpers),
            turn: 0
        };
    }

    function createLineForTurn(state) {
        const humanLines = [
            `AI, we're in ${state.setting}. Can we ${state.goal}?`,
            `I think we can ask ${state.helper} for a clue.`,
            `We just ran into ${state.obstacle}. What should we do?`,
            "Nice! That worked. What's our next move?"
        ];

        const aiLines = [
            `Absolutely. In ${state.setting}, our mission is to ${state.goal}.`,
            `Good idea. ${state.helper} should help us avoid mistakes.`,
            `Let's break down ${state.obstacle} into smaller steps and solve it safely.`,
            "Great teamwork. We can keep exploring or start a new story arc."
        ];

        const isHumanTurn = state.turn % 2 === 0;
        const line = isHumanTurn
            ? `Human: ${humanLines[state.turn % humanLines.length]}`
            : `AI: ${aiLines[state.turn % aiLines.length]}`;

        state.turn += 1;

        if (state.turn > 0 && state.turn % 10 === 0) {
            const nextState = createStoryState();
            state.setting = nextState.setting;
            state.goal = nextState.goal;
            state.obstacle = nextState.obstacle;
            state.helper = nextState.helper;
        }

        return line;
    }

    const storyState = createStoryState();

    let charIndex = 0;
    let currentSpeaker = "";
    let activeLine = "";

    const h1 = document.getElementById("typing-text");
    const nameLabel = document.getElementById("speaker-name");
    const line = document.getElementById("line");

    function typeWriter() {
        activeLine = createLineForTurn(storyState);

        const splitPoint = activeLine.indexOf(":");
        if (splitPoint === -1) {
            console.warn("Skipping malformed line:", activeLine);
            setTimeout(typeWriter, 0);
            return;
        }

        const newName = activeLine.substring(0, splitPoint).trim();
        const message = activeLine.substring(splitPoint + 1).trim();

        if (newName !== currentSpeaker) {
            nameLabel.style.opacity = 0;
            line.classList.remove("line-open");

            setTimeout(() => {
                nameLabel.textContent = newName;
                currentSpeaker = newName;

                const color = (newName === "AI") ? "#007acc" : "#555";
                h1.style.color = color;
                line.style.backgroundColor = color;

                nameLabel.style.opacity = 1;
                line.classList.add("line-open");

                setTimeout(() => {
                    h1.style.opacity = 1;
                    startTyping(message);
                }, 800);
            }, 800);
        } else {
            h1.style.opacity = 1;
            startTyping(message);
        }
    }

    function startTyping(message) {
        if (charIndex < message.length) {
            h1.textContent += message.charAt(charIndex);
            charIndex++;
            setTimeout(() => startTyping(message), 35);
        } else {
            setTimeout(() => {
                h1.style.opacity = 0;
                setTimeout(() => {
                    h1.textContent = "";
                    charIndex = 0;
                    typeWriter();
                }, 600);
            }, 3000);
        }
    }

    window.onload = typeWriter;
</script>
</body>
</html>
